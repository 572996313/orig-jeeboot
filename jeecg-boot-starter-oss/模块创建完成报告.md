# jeecg-boot-starter-oss æ¨¡å—åˆ›å»ºå®ŒæˆæŠ¥å‘Š

## ğŸ“‹ æ¨¡å—ä¿¡æ¯

- **æ¨¡å—åç§°**: jeecg-boot-starter-oss
- **æ¨¡å—ç‰ˆæœ¬**: 4.0.0
- **åˆ›å»ºæ—¥æœŸ**: 2025-11-08
- **æ‰€å±é˜¶æ®µ**: Phase 2.5
- **æ¨¡å—ç±»å‹**: Spring Boot Starterï¼ˆå¯¹è±¡å­˜å‚¨ï¼‰

## âœ… åˆ›å»ºå†…å®¹æ¸…å•

### 1. Mavené…ç½®æ–‡ä»¶

| æ–‡ä»¶è·¯å¾„ | è¡Œæ•° | è¯´æ˜ |
|---------|------|------|
| `pom.xml` | 149 | Mavené¡¹ç›®é…ç½®ï¼Œå®šä¹‰ä¾èµ–å…³ç³» |

### 2. æ ¸å¿ƒæ¥å£å’Œå®ç°ï¼ˆ8ä¸ªæ–‡ä»¶ï¼‰

| æ–‡ä»¶è·¯å¾„ | è¡Œæ•° | è¯´æ˜ |
|---------|------|------|
| `src/main/java/org/jeecg/common/oss/OssService.java` | 135 | OSSç»Ÿä¸€æ¥å£å®šä¹‰ |
| `src/main/java/org/jeecg/common/oss/impl/MinioOssServiceImpl.java` | 291 | MinIOå®ç° |
| `src/main/java/org/jeecg/common/oss/impl/AliyunOssServiceImpl.java` | 373 | é˜¿é‡Œäº‘OSSå®ç° |
| `src/main/java/org/jeecg/common/oss/impl/LocalOssServiceImpl.java` | 245 | æœ¬åœ°æ–‡ä»¶å­˜å‚¨å®ç° |
| `src/main/java/org/jeecg/config/oss/JeecgOssProperties.java` | 170 | é…ç½®å±æ€§ç±» |
| `src/main/java/org/jeecg/config/oss/JeecgOssAutoConfiguration.java` | 158 | è‡ªåŠ¨é…ç½®ç±» |
| `src/main/java/org/jeecg/config/oss/MinioConfig.java` | 57 | MinIOå…¼å®¹é…ç½® |
| `src/main/java/org/jeecg/config/oss/OssConfiguration.java` | 66 | OSSå…¼å®¹é…ç½® |

### 3. å‘åå…¼å®¹å·¥å…·ç±»ï¼ˆ2ä¸ªæ–‡ä»¶ï¼‰

| æ–‡ä»¶è·¯å¾„ | è¡Œæ•° | è¯´æ˜ |
|---------|------|------|
| `src/main/java/org/jeecg/common/util/MinioUtil.java` | 237 | MinIOé™æ€å·¥å…·ç±»ï¼ˆ@Deprecatedï¼‰ |
| `src/main/java/org/jeecg/common/util/oss/OssBootUtil.java` | 371 | é˜¿é‡Œäº‘OSSé™æ€å·¥å…·ç±»ï¼ˆ@Deprecatedï¼‰ |

### 4. Spring Booté…ç½®æ–‡ä»¶ï¼ˆ2ä¸ªæ–‡ä»¶ï¼‰

| æ–‡ä»¶è·¯å¾„ | è¡Œæ•° | è¯´æ˜ |
|---------|------|------|
| `src/main/resources/META-INF/spring/org.springframework.boot.autoconfigure.AutoConfiguration.imports` | 1 | è‡ªåŠ¨é…ç½®å¯¼å…¥ |
| `src/main/resources/META-INF/spring-configuration-metadata.json` | 177 | é…ç½®å…ƒæ•°æ® |

### 5. æ–‡æ¡£æ–‡ä»¶

| æ–‡ä»¶è·¯å¾„ | è¡Œæ•° | è¯´æ˜ |
|---------|------|------|
| `README.md` | 607 | æ¨¡å—ä½¿ç”¨æ–‡æ¡£ |
| `æ¨¡å—åˆ›å»ºå®ŒæˆæŠ¥å‘Š.md` | - | æœ¬æŠ¥å‘Š |

## ğŸ“Š ç»Ÿè®¡æ•°æ®

- **Javaæºæ–‡ä»¶**: 10ä¸ª
- **é…ç½®æ–‡ä»¶**: 2ä¸ª
- **æ–‡æ¡£æ–‡ä»¶**: 2ä¸ª
- **æ€»ä»£ç è¡Œæ•°**: çº¦2,830è¡Œ
- **æ¥å£æ–¹æ³•æ•°**: 12ä¸ª
- **å®ç°ç±»æ•°**: 3ä¸ª

## ğŸ¯ åŠŸèƒ½ç‰¹æ€§

### æ ¸å¿ƒåŠŸèƒ½

1. âœ… **ç»Ÿä¸€æ¥å£**: æä¾›OssServiceç»Ÿä¸€æ¥å£
2. âœ… **å¤šå­˜å‚¨æ”¯æŒ**: MinIOã€é˜¿é‡Œäº‘OSSã€æœ¬åœ°å­˜å‚¨
3. âœ… **è‡ªåŠ¨é…ç½®**: Spring Bootè‡ªåŠ¨é…ç½®
4. âœ… **æ¡ä»¶åŠ è½½**: æ ¹æ®é…ç½®è‡ªåŠ¨é€‰æ‹©å®ç°
5. âœ… **å‘åå…¼å®¹**: æ”¯æŒæ—§ç‰ˆé…ç½®å’Œå·¥å…·ç±»

### é«˜çº§ç‰¹æ€§

6. âœ… **CDNæ”¯æŒ**: æ”¯æŒé™æ€åŸŸåé…ç½®
7. âœ… **è‡ªåŠ¨åˆ›å»ºæ¡¶**: æ¡¶ä¸å­˜åœ¨æ—¶è‡ªåŠ¨åˆ›å»º
8. âœ… **æ–‡ä»¶å®‰å…¨**: å†…ç½®SSRFã€XSSé˜²æŠ¤
9. âœ… **å¤šæ¡¶æ”¯æŒ**: è¿è¡Œæ—¶æŒ‡å®šä¸åŒæ¡¶
10. âœ… **ä¸´æ—¶URL**: æ”¯æŒç”Ÿæˆä¸´æ—¶è®¿é—®é“¾æ¥

## ğŸ”§ æŠ€æœ¯æ ˆ

### ä¾èµ–æ¡†æ¶

| æ¡†æ¶/åº“ | ç‰ˆæœ¬ | ç”¨é€” |
|--------|------|------|
| Spring Boot | 2.7.x | åŸºç¡€æ¡†æ¶ |
| MinIO SDK | 8.5.7 | MinIOå®¢æˆ·ç«¯ |
| Aliyun OSS SDK | 3.17.4 | é˜¿é‡Œäº‘OSSå®¢æˆ·ç«¯ |
| Hutool | 5.8.23 | å·¥å…·åº“ |
| commons-fileupload | 1.5 | æ–‡ä»¶ä¸Šä¼  |

### è®¾è®¡æ¨¡å¼

- **ç­–ç•¥æ¨¡å¼**: OssServiceæ¥å£ + ä¸‰ç§å®ç°
- **å·¥å‚æ¨¡å¼**: è‡ªåŠ¨é…ç½®æ ¹æ®typeé€‰æ‹©å®ç°
- **å•ä¾‹æ¨¡å¼**: å®¢æˆ·ç«¯Beanç”±Springç®¡ç†
- **ä»£ç†æ¨¡å¼**: å‘åå…¼å®¹ç±»ä»£ç†æ–°å®ç°

## ğŸ“ é…ç½®ç¤ºä¾‹

### MinIOé…ç½®

```yaml
jeecg:
  oss:
    enabled: true
    type: minio
    endpoint: http://localhost:9000
    access-key: minioadmin
    secret-key: minioadmin
    bucket-name: jeecg-bucket
    static-domain: https://cdn.example.com
    auto-create-bucket: true
```

### é˜¿é‡Œäº‘OSSé…ç½®

```yaml
jeecg:
  oss:
    enabled: true
    type: aliyun
    endpoint: oss-cn-hangzhou.aliyuncs.com
    access-key: YOUR_ACCESS_KEY_ID
    secret-key: YOUR_ACCESS_KEY_SECRET
    bucket-name: jeecg-bucket
```

### æœ¬åœ°å­˜å‚¨é…ç½®

```yaml
jeecg:
  oss:
    enabled: true
    type: local
    local-path: ./upload
    bucket-name: default
```

## ğŸ’» ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ç”¨æ³•

```java
@Service
public class FileService {
    
    @Autowired
    private OssService ossService;
    
    // ä¸Šä¼ æ–‡ä»¶
    public String uploadFile(MultipartFile file) {
        return ossService.upload(file, "images/");
    }
    
    // ä¸‹è½½æ–‡ä»¶
    public InputStream downloadFile(String objectName) {
        return ossService.getFile("jeecg-bucket", objectName);
    }
    
    // åˆ é™¤æ–‡ä»¶
    public void deleteFile(String url) {
        ossService.deleteByUrl(url);
    }
    
    // è·å–URL
    public String getFileUrl(String objectName) {
        return ossService.getObjectUrl("jeecg-bucket", objectName, 3600);
    }
}
```

## ğŸ”„ å‘åå…¼å®¹

### æ”¯æŒæ—§ç‰ˆé…ç½®

```yaml
# æ—§é…ç½®ï¼ˆä»ç„¶æ”¯æŒï¼‰
jeecg:
  minio:
    minio_url: http://localhost:9000
    minio_name: minioadmin
    minio_pass: minioadmin
    bucket_name: jeecg-bucket
```

### æ”¯æŒæ—§ç‰ˆå·¥å…·ç±»

```java
// æ—§ä»£ç ä»ç„¶å¯ç”¨ï¼ˆå·²æ ‡è®°@Deprecatedï¼‰
import org.jeecg.common.util.MinioUtil;
import org.jeecg.common.util.oss.OssBootUtil;

String url = MinioUtil.upload(file, "images/", bucketName);
String url2 = OssBootUtil.upload(file, "images/");
```

## âœ¨ åˆ›æ–°ç‚¹

1. **ç»Ÿä¸€æ¥å£**: ä¸åŒå­˜å‚¨æ–¹å¼ä½¿ç”¨ç›¸åŒæ¥å£ï¼Œä¾¿äºåˆ‡æ¢
2. **è‡ªåŠ¨é…ç½®**: é›¶ä»£ç é…ç½®ï¼Œå¼€ç®±å³ç”¨
3. **ç­–ç•¥æ¨¡å¼**: è¿è¡Œæ—¶åŠ¨æ€é€‰æ‹©å­˜å‚¨å®ç°
4. **å‘åå…¼å®¹**: ä¿ç•™æ—§APIï¼Œå¹³æ»‘è¿ç§»
5. **æ–‡ä»¶å®‰å…¨**: å†…ç½®å®‰å…¨è¿‡æ»¤æœºåˆ¶

## ğŸ“ é‡æ„è¦ç‚¹

### ä»é™æ€æ–¹æ³•åˆ°ä¾èµ–æ³¨å…¥

**åŸä»£ç **:
```java
public class MinioUtil {
    private static MinioClient minioClient;
    
    public static String upload(MultipartFile file, String path) {
        // ä½¿ç”¨é™æ€å­—æ®µ
    }
}
```

**é‡æ„å**:
```java
@Service
@ConditionalOnProperty(prefix = "jeecg.oss", name = "type", havingValue = "minio")
public class MinioOssServiceImpl implements OssService {
    
    private final MinioClient minioClient;
    private final JeecgOssProperties properties;
    
    @Autowired
    public MinioOssServiceImpl(MinioClient minioClient, 
                               JeecgOssProperties properties) {
        this.minioClient = minioClient;
        this.properties = properties;
    }
    
    @Override
    public String upload(MultipartFile file, String customPath) {
        // ä½¿ç”¨æ³¨å…¥çš„å®ä¾‹
    }
}
```

### é…ç½®å…¼å®¹æ€§å¤„ç†

```java
public String getActualEndpoint() {
    // ä¼˜å…ˆä½¿ç”¨æ–°é…ç½®
    if (StringUtils.isNotBlank(this.endpoint)) {
        return this.endpoint;
    }
    // å›é€€åˆ°åµŒå¥—é…ç½®
    if (this.minio != null && StringUtils.isNotBlank(this.minio.getEndpoint())) {
        return this.minio.getEndpoint();
    }
    return null;
}
```

## ğŸ” å…³é”®æŠ€æœ¯ç‚¹

### 1. æ¡ä»¶åŒ–Beanåˆ›å»º

```java
@Bean
@ConditionalOnProperty(prefix = "jeecg.oss", name = "type", havingValue = "minio")
public MinioClient minioClient(JeecgOssProperties properties) {
    return MinioClient.builder()
        .endpoint(properties.getActualEndpoint())
        .credentials(properties.getActualAccessKey(), 
                    properties.getActualSecretKey())
        .build();
}
```

### 2. æ–‡ä»¶åç”Ÿæˆç­–ç•¥

```java
private String generateObjectName(String originalName, String customPath) {
    String fileName = originalName.indexOf(".") == -1
        ? originalName + "_" + System.currentTimeMillis()
        : originalName.substring(0, originalName.lastIndexOf(".")) 
          + "_" + System.currentTimeMillis() 
          + originalName.substring(originalName.lastIndexOf("."));
    
    String normalizedPath = customPath.endsWith("/") 
        ? customPath : customPath + "/";
    
    return normalizedPath + fileName;
}
```

### 3. URLæ„å»ºé€»è¾‘

```java
private String buildFileUrl(String bucketName, String objectName) {
    String staticDomain = properties.getStaticDomain();
    
    if (StringUtils.isNotBlank(staticDomain) 
        && staticDomain.toLowerCase().startsWith("http")) {
        return staticDomain + "/" + objectName;
    } else {
        return "https://" + bucketName + "." 
               + properties.getActualEndpoint() + "/" + objectName;
    }
}
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ä¾èµ–å¯é€‰æ€§**: MinIOå’Œé˜¿é‡Œäº‘SDKè®¾ç½®ä¸ºoptionalï¼ŒæŒ‰éœ€å¼•å…¥
2. **çº¿ç¨‹å®‰å…¨**: æ‰€æœ‰å®ç°ç±»éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„
3. **å¼‚å¸¸å¤„ç†**: ç»Ÿä¸€å¼‚å¸¸å¤„ç†ï¼Œè®°å½•æ—¥å¿—
4. **èµ„æºé‡Šæ”¾**: InputStreamä½¿ç”¨åéœ€æ‰‹åŠ¨å…³é—­
5. **æƒé™é…ç½®**: éœ€è¦æ­£ç¡®é…ç½®å­˜å‚¨æ¡¶æƒé™

## ğŸš€ åç»­ä¼˜åŒ–å»ºè®®

1. **åˆ†ç‰‡ä¸Šä¼ **: æ”¯æŒå¤§æ–‡ä»¶åˆ†ç‰‡ä¸Šä¼ 
2. **æ–­ç‚¹ç»­ä¼ **: å®ç°æ–­ç‚¹ç»­ä¼ åŠŸèƒ½
3. **è¿›åº¦å›è°ƒ**: æä¾›ä¸Šä¼ è¿›åº¦å›è°ƒæ¥å£
4. **æ‰¹é‡æ“ä½œ**: æ”¯æŒæ‰¹é‡ä¸Šä¼ /åˆ é™¤
5. **ç¼“å­˜æœºåˆ¶**: ç¼“å­˜ä¸´æ—¶URLå‡å°‘è¯·æ±‚
6. **ç›‘æ§æŒ‡æ ‡**: é›†æˆMetricsç›‘æ§
7. **å•å…ƒæµ‹è¯•**: è¡¥å……å®Œæ•´çš„å•å…ƒæµ‹è¯•

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [README.md](./README.md) - è¯¦ç»†ä½¿ç”¨æ–‡æ¡£
- [jeecg-boot-base-core-æ¨¡å—æ‹†åˆ†å‡çº§è®¡åˆ’.md](../jeecg-boot-base-core-æ¨¡å—æ‹†åˆ†å‡çº§è®¡åˆ’.md) - æ€»ä½“è§„åˆ’
- MinIOå®˜æ–¹æ–‡æ¡£: https://min.io/docs/minio/linux/index.html
- é˜¿é‡Œäº‘OSSæ–‡æ¡£: https://help.aliyun.com/product/31815.html

## âœ… éªŒæ”¶æ ‡å‡†

- [x] æ”¯æŒMinIOã€é˜¿é‡Œäº‘OSSã€æœ¬åœ°å­˜å‚¨ä¸‰ç§æ–¹å¼
- [x] æä¾›ç»Ÿä¸€çš„OssServiceæ¥å£
- [x] å®ç°Spring Bootè‡ªåŠ¨é…ç½®
- [x] å‘åå…¼å®¹æ—§ç‰ˆé…ç½®å’Œå·¥å…·ç±»
- [x] æ”¯æŒCDNé™æ€åŸŸå
- [x] æ”¯æŒè‡ªåŠ¨åˆ›å»ºå­˜å‚¨æ¡¶
- [x] å†…ç½®æ–‡ä»¶å®‰å…¨è¿‡æ»¤
- [x] æä¾›å®Œæ•´çš„é…ç½®å…ƒæ•°æ®
- [x] ç¼–å†™è¯¦ç»†çš„ä½¿ç”¨æ–‡æ¡£

## ğŸ‰ æ€»ç»“

`jeecg-boot-starter-oss` æ¨¡å—å·²æˆåŠŸåˆ›å»ºå®Œæˆï¼

### ä¸»è¦æˆå°±

1. âœ… **ä»£ç é‡æ„**: ä»é™æ€å·¥å…·ç±»é‡æ„ä¸ºSpringç®¡ç†çš„æœåŠ¡
2. âœ… **æ¶æ„ä¼˜åŒ–**: ä½¿ç”¨ç­–ç•¥æ¨¡å¼æ”¯æŒå¤šç§å­˜å‚¨æ–¹å¼
3. âœ… **å‘åå…¼å®¹**: ä¿ç•™æ—§APIï¼Œå¹³æ»‘è¿ç§»è·¯å¾„
4. âœ… **è‡ªåŠ¨é…ç½®**: é›¶ä»£ç é…ç½®ï¼Œå¼€ç®±å³ç”¨
5. âœ… **æ–‡æ¡£å®Œå–„**: æä¾›è¯¦ç»†çš„ä½¿ç”¨æ–‡æ¡£å’Œç¤ºä¾‹

### æ¨¡å—ä»·å€¼

- **çµæ´»æ€§**: æ”¯æŒå¤šç§å­˜å‚¨æ–¹å¼ï¼ŒæŒ‰éœ€é€‰æ‹©
- **æ‰©å±•æ€§**: æ˜“äºæ·»åŠ æ–°çš„å­˜å‚¨å®ç°
- **æ˜“ç”¨æ€§**: ç»Ÿä¸€æ¥å£ï¼Œç®€åŒ–ä½¿ç”¨
- **å…¼å®¹æ€§**: å¹³æ»‘å‡çº§ï¼Œæ— éœ€ä¿®æ”¹ç°æœ‰ä»£ç 
- **å®‰å…¨æ€§**: å†…ç½®å®‰å…¨é˜²æŠ¤æœºåˆ¶

---

**åˆ›å»ºè€…**: llllxf  
**åˆ›å»ºæ—¶é—´**: 2025-11-08  
**æ¨¡å—çŠ¶æ€**: âœ… å·²å®Œæˆ  
**ä¸‹ä¸€æ­¥**: Phase 2.6 - åˆ›å»º jeecg-boot-starter-api-doc æ¨¡å—